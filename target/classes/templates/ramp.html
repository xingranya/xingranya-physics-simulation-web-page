<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">

    <!-- 其他meta标签 -->
    <link rel="stylesheet" href="/css/style.css">


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>斜面滑动</title>
    <style>
        .canvas-container {
            margin: 20px 0;
            border: 1px solid #ddd;
            background-color: #f0f8ff;
        }

        .result-container {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .back-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }

        .back-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <h1>斜面滑动计算</h1>
    <form action="/calculateRamp" method="post">
        <label for="angle">斜面角度 (°):</label>
        <input type="number" name="angle" th:value="${angle}" step="0.1" required><br><br>
        
        <label for="mass">物体质量 (kg):</label>
        <input type="number" name="mass" th:value="${mass}" step="0.1" required><br><br>
        
        <label for="frictionCoefficient">摩擦系数:</label>
        <input type="number" name="frictionCoefficient" th:value="${frictionCoefficient}" step="0.01" required><br><br>
        
        <button type="submit">计算加速度</button>
    </form>

    <div class="result-container" th:if="${acceleration}">
        <h3>计算结果：</h3>
        <p>净加速度 = <span th:text="${acceleration}">0.0</span> m/s²</p>
        <p>重力加速度分量 = <span th:text="${mass * 9.80665 * Math.sin(Math.toRadians(angle))}">0.0</span> m/s²</p>
        <p>摩擦力 = <span th:text="${frictionCoefficient * mass * 9.80665 * Math.cos(Math.toRadians(angle))}">0.0</span> N</p>
        <p>法向力 = <span th:text="${mass * 9.80665 * Math.cos(Math.toRadians(angle))}">0.0</span> N</p>
        <p>重力 = <span th:text="${mass * 9.80665}">0.0</span> N</p>
    </div>

    <div class="canvas-container">
        <canvas id="rampCanvas" width="400" height="300"></canvas>
    </div>

    <a href="/" class="back-button">返回主页</a>

    <script th:inline="javascript">
        const canvas = document.getElementById('rampCanvas');
        const ctx = canvas.getContext('2d');
        let box = {
            x: 320,
            y: 220,
            width: 30,
            height: 30,
            vx: 0,
            vy: 0
        };
    
        function drawRamp(angle) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制天空背景
            ctx.fillStyle = '#f0f8ff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制斜面
            ctx.beginPath();
            ctx.moveTo(50, 250);
            ctx.lineTo(350, 250);
            ctx.lineTo(350, 250 - 200 * Math.tan(Math.PI * angle / 180));
            ctx.closePath();
            ctx.fillStyle = '#f5f5f5';
            ctx.fill();
            ctx.strokeStyle = '#666';
            ctx.stroke();
            
            // 绘制物体
            ctx.fillStyle = '#2196F3';
            ctx.fillRect(box.x, box.y, box.width, box.height);
            ctx.strokeStyle = '#1976D2';
            ctx.strokeRect(box.x, box.y, box.width, box.height);
        }
    
        function startAnimation(angle, acceleration) {
            const radians = Math.PI * angle / 180;
            const rampTopY = 250 - 200 * Math.tan(radians);
            let startTime;
            let lastTimestamp;
            let actualAcceleration = acceleration;
            
            function animate(timestamp) {
                if (!startTime) {
                    startTime = timestamp;
                    lastTimestamp = timestamp;
                }
                
                const deltaTime = (timestamp - lastTimestamp) / 1000; // 秒
                lastTimestamp = timestamp;
                
                // 更精确的物理计算
                const distance = 0.5 * actualAcceleration * Math.pow((timestamp - startTime)/1000, 2) * 100;
                box.x = 320 - distance * Math.cos(radians);
                box.y = 220 - distance * Math.sin(radians);
                
                // 添加摩擦力效果
                if (box.x <= 50) {
                    box.x = 50;
                    cancelAnimationFrame(animationId);
                    
                    // 添加物体停止后的微小震动效果
                    setTimeout(() => {
                        box.y += 1;
                        drawRamp(angle);
                        setTimeout(() => {
                            box.y -= 1;
                            drawRamp(angle);
                        }, 50);
                    }, 100);
                }
                
                drawRamp(angle);
                animationId = requestAnimationFrame(animate);
            }
    
            drawRamp(angle);
            animationId = requestAnimationFrame(animate);
        }

        // 当页面加载时启动动画
        window.onload = function() {
            const angle = parseFloat([[${angle}]] || 30);
            const acceleration = parseFloat([[${acceleration}]] || 0);
            drawRamp(angle);
            if (acceleration > 0) {
                startAnimation(angle, acceleration);
            }
        };

        // 当表单提交后重新启动动画
        document.querySelector('form').addEventListener('submit', function() {
            const angle = parseFloat(document.querySelector('input[name="angle"]').value);
            const acceleration = parseFloat([[${acceleration}]] || 0);
            if (acceleration > 0) {
                startAnimation(angle, acceleration);
            } else {
                drawRamp(angle);
            }
        });
    </script>
</body>
</html>